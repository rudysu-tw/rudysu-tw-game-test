<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ‘å¿ƒæ„›çš„å¥³å…’ Remake - è±ªè¯ç‰ˆ</title>
    <style>
        :root {
            --primary: #FF6B6B;
            --secondary: #4ECDC4;
            --dark: #2C3E50;
            --light: #F7FFF7;
            --accent: #FFE66D;
            --danger: #FF0000;
            --success: #00b894;
        }

        body {
            font-family: 'Segoe UI', 'Microsoft JhengHei', sans-serif;
            background: linear-gradient(135deg, #fdfbfb 0%, #ebedee 100%);
            color: var(--dark);
            margin: 0;
            padding: 0;
            height: 100vh;
            display: flex;
            justify-content: center;
            overflow: hidden; /* Prevent body scroll, handle in app */
        }

        /* App Container */
        .app-container {
            width: 100%;
            max-width: 500px;
            background: white;
            height: 100%;
            display: flex;
            flex-direction: column;
            box-shadow: 0 0 30px rgba(0,0,0,0.1);
            position: relative;
        }

        /* Header & Info */
        header {
            background: var(--primary);
            color: white;
            padding: 10px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            z-index: 10;
        }

        .header-stats {
            font-size: 0.9rem;
            display: flex;
            gap: 15px;
        }

        /* Stats Bar (Horizontal Scroll) */
        .stats-scroller {
            background: #fff;
            padding: 10px 5px;
            display: flex;
            gap: 10px;
            overflow-x: auto;
            white-space: nowrap;
            border-bottom: 1px solid #eee;
            scrollbar-width: none; /* Firefox */
        }
        .stats-scroller::-webkit-scrollbar { display: none; }

        .stat-pill {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 20px;
            padding: 5px 12px;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 5px;
            box-shadow: 0 2px 0 rgba(0,0,0,0.05);
            flex-shrink: 0;
        }
        
        .stat-pill.stress {
            border-color: var(--primary);
            color: var(--primary);
            font-weight: bold;
        }

        /* Main Game Area */
        .game-area {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            background-image: radial-gradient(#e0e0e0 1px, transparent 1px);
            background-size: 20px 20px;
            position: relative;
        }

        /* Character & Mood */
        .character-stage {
            text-align: center;
            margin-bottom: 20px;
            position: relative;
        }
        
        .char-img {
            width: 120px;
            height: 120px;
            background: #ffeaa7;
            border-radius: 50%;
            display: inline-flex;
            justify-content: center;
            align-items: center;
            font-size: 3.5rem;
            border: 4px solid white;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            position: relative;
            z-index: 1;
        }

        .speech-bubble {
            background: white;
            padding: 8px 15px;
            border-radius: 15px;
            position: absolute;
            top: 0;
            right: 10%;
            font-size: 0.8rem;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            max-width: 150px;
            animation: float 3s ease-in-out infinite;
            z-index: 2;
        }
        
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-5px); }
            100% { transform: translateY(0px); }
        }

        /* Option Cards */
        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 20px;
        }

        .option-card {
            background: white;
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 4px 0 #e0e0e0;
            border: 1px solid #eee;
            cursor: pointer;
            transition: transform 0.1s, box-shadow 0.1s;
            position: relative;
            overflow: hidden;
        }

        .option-card:active {
            transform: translateY(4px);
            box-shadow: 0 0 0 #e0e0e0;
        }

        .option-card h3 {
            margin: 0 0 5px 0;
            font-size: 1rem;
            color: var(--dark);
        }

        .option-card .cost {
            font-size: 0.75rem;
            font-weight: bold;
            position: absolute;
            top: 10px;
            right: 10px;
        }
        .cost.money-minus { color: var(--danger); }
        .cost.money-plus { color: var(--success); }

        .option-tags {
            margin-top: 8px;
            font-size: 0.75rem;
            color: #666;
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
        }

        .tag {
            background: #eee;
            padding: 2px 6px;
            border-radius: 4px;
        }
        .tag.up { color: var(--success); background: #e8f8f5; }
        .tag.down { color: var(--danger); background: #fdeded; }

        /* Log Window */
        .log-window {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 10px;
            padding: 10px;
            height: 120px;
            overflow-y: auto;
            font-size: 0.85rem;
            border: 1px solid #eee;
            margin-top: auto; /* Push to bottom */
        }
        
        .log-line { margin-bottom: 4px; padding-bottom: 4px; border-bottom: 1px dashed #eee; }
        .log-line:last-child { border-bottom: none; }

        /* Overlays / Modals */
        .modal {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.8);
            display: none; /* Flex when active */
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
            padding: 20px;
            text-align: center;
            color: white;
            animation: fadeIn 0.3s;
        }
        .modal.active { display: flex; }

        .modal h2 { font-size: 2rem; margin-bottom: 10px; color: var(--accent); }
        .modal p { line-height: 1.6; margin-bottom: 20px; }
        
        .big-btn {
            background: var(--secondary);
            color: white;
            border: none;
            padding: 12px 30px;
            font-size: 1.2rem;
            border-radius: 30px;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(78, 205, 196, 0.4);
            transition: transform 0.2s;
        }
        .big-btn:hover { transform: scale(1.05); }

        /* Animations */
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes popUp { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        .pop-msg {
            animation: popUp 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        /* Utilities */
        .hidden { display: none !important; }
    </style>
</head>
<body>

<div class="app-container">
    
    <header>
        <div style="font-weight: bold;">ğŸ€ é¤Šè‚²æ—¥è¨˜</div>
        <div class="header-stats">
            <span>ğŸ“… <span id="display-age">8</span>æ­² <span id="display-season">æ˜¥</span></span>
            <span>ğŸ’° <span id="display-money">0</span>G</span>
        </div>
    </header>

    <div class="stats-scroller" id="stats-container">
        <div class="stat-pill stress">ğŸ˜« å£“åŠ›: <span id="stat-stress">0</span>%</div>
    </div>

    <div id="start-screen" class="modal active" style="background: white; color: var(--dark);">
        <div class="pop-msg">
            <h1>ğŸŒ¸ æˆ‘å¿ƒæ„›çš„å¥³å…’ ğŸŒ¸</h1>
            <p>é€™æ˜¯ä¸€å€‹å……æ»¿æ„›èˆ‡è²¬ä»»çš„é¤ŠæˆéŠæˆ²ã€‚<br>åœ¨æœ‰é™çš„10å¹´å…§ï¼Œå¼•å°å¥¹èµ°å‘æœªä¾†ã€‚</p>
            <div style="text-align: left; background: #f8f9fa; padding: 15px; border-radius: 10px; margin: 20px 0; font-size: 0.9rem;">
                <strong>ğŸ® æ–°æ©Ÿåˆ¶èªªæ˜ï¼š</strong>
                <ul style="margin: 5px 0; padding-left: 20px;">
                    <li><strong>å£“åŠ›ç³»çµ±ï¼š</strong>å·¥ä½œå­¸ç¿’æœƒç´¯ç©å£“åŠ›ï¼Œéé«˜æœƒç”Ÿç—…ï¼è¨˜å¾—ä¼‘æ¯ã€‚</li>
                    <li><strong>çˆ¶è¦ªè–ªæ°´ï¼š</strong>æ¯å­£åˆçˆ¶è¦ªæœƒå¸¶è–ªæ°´å›å®¶ï¼Œé€™æ˜¯ä¸»è¦æ”¶å…¥ã€‚</li>
                    <li><strong>å¤©è³¦è¦ºé†’ï¼š</strong>12æ­²æ™‚æœƒæ ¹æ“šåŸ¹é¤Šæ–¹å‘è¦ºé†’ç‰¹æ®Šèƒ½åŠ›ã€‚</li>
                </ul>
            </div>
            <button class="big-btn" onclick="game.init()">é–‹å§‹æ–°çš„æ—…ç¨‹</button>
        </div>
    </div>

    <div id="game-view" class="game-area hidden">
        
        <div class="character-stage">
            <div class="speech-bubble" id="char-bubble">çˆ¸çˆ¸ï¼Œä»Šå¤©è¦å­¸ä»€éº¼ï¼Ÿ</div>
            <div class="char-img" id="char-avatar">ğŸ‘§</div>
            <div style="margin-top: 10px; font-size: 0.85rem; color: #666;">
                çˆ¶è·: <span id="father-info" style="font-weight:bold; color:var(--dark);"></span> | 
                å€‹æ€§: <span id="daughter-info" style="font-weight:bold; color:var(--dark);"></span><br>
                <span id="talent-info" style="color: purple; font-weight: bold; display:none;">âœ¨ å¤©è³¦: ç„¡</span>
            </div>
        </div>

        <h3 style="font-size: 1rem; margin-bottom: 10px; color: #555;">ğŸ“‹ æœ¬å­£è¡Œç¨‹è¦åŠƒ</h3>
        
        <div class="options-grid" id="options-container">
            </div>

        <div class="log-window" id="game-log">
            <div class="log-line" style="color: #888;">æ—¥è¨˜æœ¬å·²æº–å‚™å¥½...</div>
        </div>

    </div>

    <div id="age-up-modal" class="modal">
        <div style="font-size: 4rem;">ğŸ‚</div>
        <h2>ç”Ÿæ—¥å¿«æ¨‚ï¼</h2>
        <p>å¥³å…’é•·å¤§äº†ä¸€æ­²ï¼Œç¾åœ¨æ˜¯ <span id="modal-new-age" style="color: var(--accent); font-weight: bold;">9</span> æ­²äº†ï¼</p>
        <p id="age-up-msg" style="font-size: 0.9rem; color: #ddd;"></p>
        <button class="big-btn" onclick="game.closeAgeUp()">ç¹¼çºŒæˆé•·</button>
    </div>

    <div id="ending-modal" class="modal" style="justify-content: flex-start; overflow-y: auto;">
        <div style="margin-top: 50px;">
            <div style="font-size: 5rem;">ğŸ“œ</div>
            <h2 id="end-title">çµå±€åç¨±</h2>
            <p id="end-desc" style="font-size: 1.1rem;">çµå±€æè¿°...</p>
            <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px; margin-top: 20px;">
                <h4>æœ€çµ‚ç´€éŒ„</h4>
                <div id="end-stats" style="font-size: 0.9rem; line-height: 1.8;"></div>
            </div>
            <button class="big-btn" style="margin-top: 20px; background: var(--primary);" onclick="location.reload()">é‡æ–°é–‹å§‹äººç”Ÿ</button>
        </div>
    </div>

</div>

<script>
    // --- DATA & CONFIG ---
    const SEASONS = ['æ˜¥', 'å¤', 'ç§‹', 'å†¬'];
    
    // Stats Mapping
    const STAT_MAP = {
        stm: { name: 'é«”åŠ›', icon: 'ğŸ’ª' },
        int: { name: 'æ™ºåŠ›', icon: 'ğŸ§ ' },
        chm: { name: 'é­…åŠ›', icon: 'ğŸ’ƒ' },
        mor: { name: 'é“å¾·', icon: 'âš–ï¸' },
        art: { name: 'æ°£è³ª', icon: 'ğŸ¨' },
        sen: { name: 'æ„Ÿå—', icon: 'â¤ï¸' },
        stress: { name: 'å£“åŠ›', icon: 'ğŸ˜«' }
    };

    const PERSONALITIES = [
        { id: 'gentle', name: 'æº«æŸ”', desc: 'é“å¾·èˆ‡æ„Ÿå—æˆé•·å¿«ï¼Œå£“åŠ›ç´¯ç©æ…¢' },
        { id: 'active', name: 'æ´»æ½‘', desc: 'é«”åŠ›æˆé•·å¿«ï¼Œä½†å®¹æ˜“è‚šå­é¤“(èŠ±éŒ¢)' },
        { id: 'smart', name: 'è°ç©', desc: 'æ™ºåŠ›æˆé•·å¿«ï¼Œä½†å£“åŠ›ç´¯ç©å¿«' },
        { id: 'proud', name: 'å‚²å¬Œ', desc: 'é­…åŠ›é«˜ï¼Œæœ‰æ™‚æœƒæ‹’çµ•å·¥ä½œ' },
        { id: 'lazy', name: 'æ‡¶æ•£', desc: 'å…¨ç´ è³ªæˆé•·æ…¢ï¼Œä½†å£“åŠ›ç´¯ç©æ¥µæ…¢' },
        { id: 'curious', name: 'å¥½å¥‡', desc: 'éš¨æ©Ÿäº‹ä»¶æ•ˆæœåŠ å€' },
        { id: 'noble', name: 'è²´æ—æ°£', desc: 'æ°£è³ªåˆå§‹é«˜ï¼Œæ‰“å·¥æ”¶ç›Šä½' },
        { id: 'wild', name: 'é‡å­©å­', desc: 'é«”åŠ›æ¥µé«˜ï¼Œé“å¾·æ¥µä½' }
    ];

    const FATHER_JOBS = [
        { name: 'ç‹åœ‹é¨å£«', salary: 800, bonus: 'stm', desc: 'æ”¶å…¥ç©©å®šï¼Œæ“…é•·é«”èƒ½æ•™è‚²' },
        { name: 'å¤§å¯Œå•†', salary: 2000, bonus: 'money', desc: 'æ”¶å…¥æ¥µé«˜ï¼Œä½†é™ªä¼´æ™‚é–“å°‘' },
        { name: 'æµæµªè©©äºº', salary: 400, bonus: 'art', desc: 'æ”¶å…¥ä¸ç©©ï¼Œä½†å……æ»¿è—è¡“æ°£æ¯' },
        { name: 'é€€ä¼‘é­”å°å¸«', salary: 1200, bonus: 'int', desc: 'æ”¶å…¥ä¸­ç­‰ï¼Œæ™ºåŠ›åŠ æˆ' },
        { name: 'ç¥æ®¿ç¥­å¸', salary: 600, bonus: 'mor', desc: 'æ”¶å…¥å°‘ï¼Œé“å¾·åŠ æˆ' },
        { name: 'è³é‡‘çµäºº', salary: 1500, bonus: 'random', desc: 'æ”¶å…¥é«˜é¢¨éšªå¤§ï¼Œæ³¢å‹•æ¥µå¤§' }
    ];

    // Creative Feature: Talents (Awakens at age 12)
    const TALENTS = [
        { id: 'athlete', name: 'å¤©ç”Ÿç¥åŠ›', cond: 'stm', eff: 'é«”åŠ›è¨“ç·´æ•ˆæœ+50%ï¼Œæ‰“å·¥é«”åŠ›æ¶ˆè€—æ¸›åŠ' },
        { id: 'genius', name: 'éç›®ä¸å¿˜', cond: 'int', eff: 'æ™ºåŠ›è¨“ç·´å¿…å®šæˆåŠŸï¼Œä¸”ç²å¾—é›™å€æ•ˆæœ' },
        { id: 'idol', name: 'å‚¾åœ‹å‚¾åŸ', cond: 'chm', eff: 'é­…åŠ›ç›¸é—œäº‹ä»¶é‡‘éŒ¢æ¶ˆè€—æ¸›åŠ' },
        { id: 'saint', name: 'è–å¥³è½‰ä¸–', cond: 'mor', eff: 'å£“åŠ›ä¸Šé™æé«˜è‡³ 150ï¼Œé“å¾·è¨“ç·´å¢åŠ é‡‘éŒ¢' },
        { id: 'artist', name: 'è¬¬æ€å¥³ç¥', cond: 'art', eff: 'æ°£è³ªè¨“ç·´åŒæ™‚å¢åŠ æ„Ÿå—' },
        { id: 'psychic', name: 'éˆæ„Ÿå°‘å¥³', cond: 'sen', eff: 'æ‰€æœ‰éš¨æ©Ÿå£äº‹ä»¶è½‰ç‚ºå¥½äº‹ä»¶' },
        { id: 'balanced', name: 'å‡¡äººæ™ºæ…§', cond: 'all', eff: 'æ¯å­£é¡å¤–ç²å¾— 200G é›¶ç”¨éŒ¢' } // Fallback
    ];

    // Massive Action Pool (Simulated ~80 via categories + variations)
    // Structure: type (edu/work/rest), cost/gain, stats changes (approx)
    const ACTIONS_RAW = [
        // Education (Cost Money, Stats ++)
        { n: 'çš‡å®¶ç¦®å„€', t:'edu', c:300, eff:{art:20, chm:10, stress:5} },
        { n: 'ç¥å­¸èª²', t:'edu', c:100, eff:{mor:15, int:5, stress:5} },
        { n: 'è»äº‹åŠè¡“', t:'edu', c:200, eff:{stm:25, stress:10} },
        { n: 'é­”æ³•ç†è«–', t:'edu', c:400, eff:{int:25, sen:5, stress:8} },
        { n: 'å®®å»·èˆè¹ˆ', t:'edu', c:300, eff:{chm:20, stm:5, stress:5} },
        { n: 'æ²¹ç•«æ•™å®¤', t:'edu', c:250, eff:{art:15, sen:15, stress:3} },
        { n: 'è‡ªç„¶ç§‘å­¸', t:'edu', c:150, eff:{int:15, stress:5} },
        { n: 'è©©æ­Œå‰µä½œ', t:'edu', c:100, eff:{sen:20, art:5, stress:2} },
        { n: 'é¦¬è¡“è¨“ç·´', t:'edu', c:500, eff:{stm:15, chm:15, stress:5} },
        { n: 'é†«å­¸è­·ç†', t:'edu', c:200, eff:{int:10, mor:10, stress:8} },
        
        // Work (Earn Money, Stats +/-, Stress ++)
        { n: 'å¹«å¿™å®¶å‹™', t:'work', g:50, eff:{stm:5, sen:-2, stress:5} },
        { n: 'è¾²å ´æ“ å¥¶', t:'work', g:120, eff:{stm:10, art:-5, stress:15} },
        { n: 'æ•™å ‚ç¾©å·¥', t:'work', g:60, eff:{mor:10, chm:-2, stress:10} },
        { n: 'é…’é¤¨ç«¯ç›¤', t:'work', g:250, eff:{chm:5, mor:-10, int:-5, stress:20} },
        { n: 'ä¿å§†æ‰“å·¥', t:'work', g:100, eff:{sen:10, stm:-5, stress:15} },
        { n: 'åœ–æ›¸é¤¨ç†', t:'work', g:80, eff:{int:8, stm:-2, stress:5} },
        { n: 'å¸‚å ´å«è³£', t:'work', g:150, eff:{int:5, art:-10, stress:18} },
        { n: 'å¢“åœ’å®ˆè¡›', t:'work', g:300, eff:{stm:10, sen:-10, stress:25} },
        { n: 'å®¶åº­æ•™å¸«', t:'work', g:180, eff:{int:5, mor:5, stress:15} }, /* Need int > 200 condition technically, but keep simple */
        { n: 'ä¼æœ¨å ´', t:'work', g:200, eff:{stm:15, art:-10, stress:25} },

        // Rest (Free/Cost, Stress --)
        { n: 'åœ¨å®¶ç¡è¦º', t:'rest', c:0, eff:{stress:-30, stm:10} },
        { n: 'å»å…¬åœ’ç©', t:'rest', c:0, eff:{stress:-20, sen:5} },
        { n: 'é€›è¡—è³¼ç‰©', t:'rest', c:300, eff:{stress:-50, chm:5} },
        { n: 'æµ·é‚Šæ•£æ­¥', t:'rest', c:50, eff:{stress:-25, sen:10} },
        { n: 'äº«ç”¨ç”œé»', t:'rest', c:100, eff:{stress:-40, stm:5} }, /* Fat? No stat for that :P */
        { n: 'æº«æ³‰æ—…è¡Œ', t:'rest', c:500, eff:{stress:-80, chm:10} },

        // Interesting Random Events (Mix)
        { n: 'é–±è®€å†’éšªå°èªª', t:'event', c:30, eff:{int:5, sen:10, stress:-5} },
        { n: 'æ‰æ˜†èŸ²', t:'event', c:0, eff:{stm:5, art:-5, stress:-10} },
        { n: 'åƒåŠ çƒ¹é£ªæ¯”è³½', t:'event', c:100, eff:{sen:15, chm:5, stress:5} },
        { n: 'è·¯è¦‹ä¸å¹³', t:'event', c:0, eff:{mor:20, stm:-10, stress:10} },
        { n: 'è¢«è²“å’ªè·Ÿè¹¤', t:'event', c:0, eff:{sen:20, stress:-15} },
        { n: 'ç ”ç©¶å¥‡æ€ªè—¥æ°´', t:'event', c:200, eff:{int:20, stm:-10, stress:10} },
        { n: 'è£é£¾æˆ¿é–“', t:'event', c:150, eff:{art:10, sen:5, stress:-5} },
        { n: 'è½çˆ¶è¦ªèªªæ•™', t:'event', c:0, eff:{mor:5, stress:10} },
        { n: 'èˆ‡é„°å±…åµæ¶', t:'event', c:0, eff:{stm:5, chm:-10, stress:15} },
        { n: 'ç™¼ç¾ç§˜å¯†åŸºåœ°', t:'event', c:0, eff:{sen:15, int:5, stress:-10} }
    ];

    // --- GAME ENGINE ---
    const game = {
        state: {
            age: 8,
            season: 0,
            money: 0,
            stats: { stm: 20, int: 20, chm: 20, mor: 20, art: 20, sen: 20, stress: 0 },
            personality: null,
            fatherJob: null,
            talent: null,
            history: []
        },

        init: function() {
            // Reset State
            this.state.age = 8;
            this.state.season = 0;
            this.state.stats = { stm: 20, int: 20, chm: 20, mor: 20, art: 20, sen: 20, stress: 0 };
            this.state.talent = null;
            
            // Randomize Character
            this.state.personality = PERSONALITIES[Math.floor(Math.random() * PERSONALITIES.length)];
            this.state.fatherJob = FATHER_JOBS[Math.floor(Math.random() * FATHER_JOBS.length)];
            this.state.money = 500 + this.state.fatherJob.salary; // Initial money

            // UI Switch
            document.getElementById('start-screen').classList.remove('active');
            document.getElementById('game-view').classList.remove('hidden');
            
            // Render Initial Info
            document.getElementById('father-info').innerText = this.state.fatherJob.name;
            document.getElementById('daughter-info').innerText = this.state.personality.name;
            document.getElementById('talent-info').style.display = 'none';
            document.getElementById('char-bubble').innerText = `çˆ¸çˆ¸ï¼Œæˆ‘æ˜¯${this.state.personality.name}çš„å­©å­å–”ï¼`;

            this.log(`æ–°çš„ç”Ÿæ´»é–‹å§‹äº†ï¼çˆ¶è¦ªè·æ¥­ï¼š${this.state.fatherJob.name}ï¼Œå¥³å…’å€‹æ€§ï¼š${this.state.personality.name}`);
            this.log(`æ”¶åˆ°ç¬¬ä¸€ç­†è³‡é‡‘èˆ‡è–ªæ°´ï¼Œå…± ${this.state.money}G`);

            this.render();
            this.generateOptions();
        },

        render: function() {
            // Header
            document.getElementById('display-age').innerText = this.state.age;
            const seasonSpan = document.getElementById('display-season');
            seasonSpan.innerText = SEASONS[this.state.season];
            seasonSpan.style.color = ['#00b894', '#fdcb6e', '#e17055', '#74b9ff'][this.state.season];
            document.getElementById('display-money').innerText = this.state.money;

            // Stats Scroll (Rebuild every time for simplicity or update values)
            const container = document.getElementById('stats-container');
            container.innerHTML = '';
            
            // Stress Pill (First)
            const stressPill = document.createElement('div');
            stressPill.className = 'stat-pill stress';
            stressPill.innerHTML = `${STAT_MAP.stress.icon} ${STAT_MAP.stress.name}: ${this.state.stats.stress}`;
            if(this.state.stats.stress > 80) stressPill.style.background = '#ffe6e6'; // Warning color
            container.appendChild(stressPill);

            // Other Stats
            ['stm', 'int', 'chm', 'mor', 'art', 'sen'].forEach(key => {
                const div = document.createElement('div');
                div.className = 'stat-pill';
                div.innerHTML = `${STAT_MAP[key].icon} ${STAT_MAP[key].name}: ${Math.floor(this.state.stats[key])}`;
                container.appendChild(div);
            });
            
            // Avatar Update (Simple age logic)
            const avatars = ['ğŸ‘§', 'ğŸ‘±â€â™€ï¸', 'ğŸ‘©'];
            let avIndex = 0;
            if(this.state.age >= 12) avIndex = 1;
            if(this.state.age >= 15) avIndex = 2;
            document.getElementById('char-avatar').innerText = avatars[avIndex];
        },

        log: function(msg) {
            const win = document.getElementById('game-log');
            const line = document.createElement('div');
            line.className = 'log-line';
            line.innerHTML = `Running... ${msg}`;
            win.appendChild(line);
            win.scrollTop = win.scrollHeight;
        },

        generateOptions: function() {
            const container = document.getElementById('options-container');
            container.innerHTML = '';

            // Randomly select 4 distinct actions from the big pool
            // To make it feel like 80+, we just use the raw list which has ~30 templates 
            // and we could slightly vary them, but 30 is enough for a prototype.
            // Let's shuffle and pick 4.
            const shuffled = [...ACTIONS_RAW].sort(() => 0.5 - Math.random());
            const picks = shuffled.slice(0, 4);

            picks.forEach(opt => {
                const card = document.createElement('div');
                card.className = 'option-card';
                
                // Hints logic (No numbers)
                let tagsHtml = '';
                for(let k in opt.eff) {
                    if(k === 'stress') continue; // Don't always show stress changes, or handle differently
                    const val = opt.eff[k];
                    if(val > 0) tagsHtml += `<span class="tag up">${STAT_MAP[k].name}ğŸ”º</span>`;
                    else if(val < 0) tagsHtml += `<span class="tag down">${STAT_MAP[k].name}ğŸ”»</span>`;
                }
                
                // Cost/Gain Display
                let costHtml = '';
                if(opt.c > 0) costHtml = `<span class="cost money-minus">-${opt.c}G</span>`;
                else if(opt.g > 0) costHtml = `<span class="cost money-plus">+${opt.g}G</span>`;
                else costHtml = `<span class="cost" style="color:#aaa">å…è²»</span>`;

                card.innerHTML = `
                    <h3>${opt.n}</h3>
                    ${costHtml}
                    <div class="option-tags">${tagsHtml}</div>
                `;
                
                card.onclick = () => this.executeAction(opt);
                container.appendChild(card);
            });
        },

        executeAction: function(act) {
            // 1. Cost Check
            if(act.c && this.state.money < act.c) {
                this.updateBubble("çˆ¸çˆ¸ï¼Œæˆ‘å€‘æ²’éŒ¢äº†...");
                return;
            }

            // 2. Stress Check (Creative Feature)
            if(act.t !== 'rest' && this.state.stats.stress > 90) {
                this.log(`<span style="color:red">å¥³å…’å£“åŠ›éå¤§å´©æ½°äº†ï¼å¼·åˆ¶è‡¥ç—…åœ¨åºŠã€‚</span>`);
                this.state.stats.stress -= 50;
                this.state.stats.stm -= 10;
                this.state.money -= 100; // Doctor fee
                this.nextTurn();
                return;
            }

            // 3. Execution
            if(act.c) this.state.money -= act.c;
            if(act.g) this.state.money += act.g;

            // Apply Stats
            let logDetails = [];
            for(let key in act.eff) {
                let val = act.eff[key];
                
                // Talent Bonus
                if(this.state.talent) {
                    if(this.state.talent.cond === key || this.state.talent.cond === 'all') {
                        if(val > 0) val = Math.floor(val * 1.5); // 50% bonus
                    }
                    if(this.state.talent.id === 'athlete' && key === 'stress' && act.t === 'work') {
                        val = Math.floor(val * 0.5); // Less stress
                    }
                }

                this.state.stats[key] += val;
                
                // Cap Checks
                if(this.state.stats[key] < 0) this.state.stats[key] = 0;
                if(key === 'stress' && this.state.stats[key] < 0) this.state.stats[key] = 0;
                
                // Log string
                const icon = STAT_MAP[key] ? STAT_MAP[key].icon : '';
                logDetails.push(`${icon}${val>0?'+':''}${val}`);
            }

            // Random Flavor Text
            const phrases = ["åšå¾—å¾ˆå¥½ï¼", "æœ‰é»å‹‰å¼·...", "é›–ç„¶å¾ˆç´¯ä½†å¾ˆå……å¯¦ã€‚", "é€™å°±æ˜¯é’æ˜¥å•Šã€‚"];
            this.updateBubble(phrases[Math.floor(Math.random()*phrases.length)]);
            
            this.log(`åŸ·è¡Œ [${act.n}] ` + logDetails.join(' '));

            this.nextTurn();
        },

        nextTurn: function() {
            // Update Time
            this.state.season++;
            
            if(this.state.season > 3) {
                this.state.season = 0;
                this.state.age++;
                this.handleYearEnd();
            } else {
                // New Season Salary
                this.addSalary();
                this.render();
                this.generateOptions();
            }
        },

        addSalary: function() {
            // Father brings money
            let salary = this.state.fatherJob.salary;
            // Job bonus randomness for Hunter
            if(this.state.fatherJob.bonus === 'random') {
                salary = Math.floor(Math.random() * 3000);
            }
            this.state.money += salary;
            // Talent 'balanced' bonus
            if(this.state.talent && this.state.talent.id === 'balanced') {
                this.state.money += 200;
            }
            this.log(`æ–°çš„å­£ç¯€ï¼Œçˆ¸çˆ¸å¸¶å›äº†è–ªæ°´ ${salary}G`);
        },

        handleYearEnd: function() {
            // Age Up Logic
            if(this.state.age > 18) {
                this.endGame();
                return;
            }

            // Trigger Age Up Modal
            const modal = document.getElementById('age-up-modal');
            document.getElementById('modal-new-age').innerText = this.state.age;
            
            let msg = "åˆé•·å¤§äº†ä¸€æ­²ï¼Œæ•¸å€¼ç™¼ç”Ÿäº†è®ŠåŒ–ã€‚";
            
            // Talent Awakening at 12
            if(this.state.age === 12 && !this.state.talent) {
                this.awakenTalent();
                msg += `<br><br><span style="color:#ffeaa7; font-size:1.2rem;">âœ¨ å¤©è³¦è¦ºé†’ï¼š${this.state.talent.name}ï¼</span><br>${this.state.talent.eff}`;
            }

            document.getElementById('age-up-msg').innerHTML = msg;
            modal.classList.add('active');
        },

        closeAgeUp: function() {
            document.getElementById('age-up-modal').classList.remove('active');
            this.addSalary(); // New year first season salary
            this.render();
            this.generateOptions();
        },

        awakenTalent: function() {
            // Find highest stat
            const s = this.state.stats;
            const stats = ['stm', 'int', 'chm', 'mor', 'art', 'sen'];
            let best = 'stm';
            let maxVal = -1;
            
            stats.forEach(k => {
                if(s[k] > maxVal) {
                    maxVal = s[k];
                    best = k;
                }
            });

            // Find matching talent
            this.state.talent = TALENTS.find(t => t.cond === best) || TALENTS[TALENTS.length-1];
            
            // UI Update
            const tInfo = document.getElementById('talent-info');
            tInfo.style.display = 'inline';
            tInfo.innerText = `âœ¨ å¤©è³¦: ${this.state.talent.name}`;
            
            this.log(`ã€é‡å¤§äº‹ä»¶ã€‘å¥³å…’è¦ºé†’äº†å¤©è³¦ [${this.state.talent.name}]`);
        },

        updateBubble: function(text) {
            const b = document.getElementById('char-bubble');
            b.innerText = text;
            // Reset animation
            b.style.animation = 'none';
            b.offsetHeight; /* trigger reflow */
            b.style.animation = 'float 3s ease-in-out infinite';
        },

        endGame: function() {
            // Simple Ending Logic (Priority based)
            const s = this.state.stats;
            let title = "å¹³å‡¡çš„å¸‚æ°‘";
            let desc = "å¥¹éè‘—å¹³éœè€Œå¿«æ¨‚çš„ç”Ÿæ´»ã€‚";

            if(s.stress > 90 && s.mor < 100) { title = "ç”Ÿç—…å®…å¥³"; desc = "å› ç‚ºå£“åŠ›éå¤§ï¼Œå¥¹é¸æ“‡äº†å°é–‰è‡ªå·±..."; }
            else if(s.mor > 800 && s.int > 600) { title = "ç‹åœ‹å¤§æ³•å®˜"; desc = "å¥¹å…¬æ­£åš´æ˜ï¼Œæˆç‚ºäº†åœ‹å®¶çš„æ³•å¾‹è±¡å¾µã€‚"; }
            else if(s.chm > 800 && s.art > 600) { title = "çµ•ä¸–èˆå§¬"; desc = "å¥¹çš„èˆå§¿è¿·å€’äº†åœ‹ç‹ï¼Œæˆç‚ºäº†å‚³èªªã€‚"; }
            else if(s.stm > 800 && s.mor > 500) { title = "çš‡å®¶é¨å£«åœ˜é•·"; desc = "å¥¹å®ˆè­·è‘—ç‹åœ‹ï¼Œå¨é¢¨å‡œå‡œã€‚"; }
            else if(s.int > 800 && s.sen > 500) { title = "çš‡å®¶ç…‰é‡‘è¡“å¸«"; desc = "å¥¹ç™¼æ˜äº†ç„¡æ•¸ç¥å¥‡çš„è—¥æ°´ã€‚"; }
            else if(s.mor < 200 && s.chm > 600) { title = "æ¬ºè©å¸«"; desc = "å¥¹åˆ©ç”¨ç¾è²Œé¨™å–éŒ¢è²¡ï¼Œè®“çˆ¶è¦ªé ­ç—›ä¸å·²ã€‚"; }
            else if(this.state.money > 20000) { title = "å•†æ¥­å·¨äº¨"; desc = "å¥¹ç¹¼æ‰¿äº†å•†æ¥­é ­è…¦ï¼Œæˆç‚ºäº†é¦–å¯Œã€‚"; }
            else if(s.art > 600) { title = "å®®å»·ç•«å®¶"; desc = "å¥¹çš„ç•«ä½œè¢«æ›åœ¨çš‡å®®æœ€é¡¯çœ¼çš„ä½ç½®ã€‚"; }
            else if(s.stm > 600) { title = "å†’éšªå®¶"; desc = "å¥¹è¸ä¸Šäº†æ¢ç´¢ä¸–ç•Œçš„æ—…ç¨‹ã€‚"; }
            else if(s.mor > 600) { title = "ä¿®å¥³"; desc = "å¥¹å°‡ä¸€ç”Ÿå¥‰ç»çµ¦äº†ç¥ã€‚"; }

            // Show Modal
            document.getElementById('ending-modal').classList.add('active');
            document.getElementById('end-title').innerText = title;
            document.getElementById('end-desc').innerText = desc;
            
            document.getElementById('end-stats').innerHTML = `
                ${STAT_MAP.stm.icon} é«”åŠ›: ${Math.floor(s.stm)} | ${STAT_MAP.int.icon} æ™ºåŠ›: ${Math.floor(s.int)}<br>
                ${STAT_MAP.chm.icon} é­…åŠ›: ${Math.floor(s.chm)} | ${STAT_MAP.mor.icon} é“å¾·: ${Math.floor(s.mor)}<br>
                ${STAT_MAP.art.icon} æ°£è³ª: ${Math.floor(s.art)} | ${STAT_MAP.sen.icon} æ„Ÿå—: ${Math.floor(s.sen)}<br>
                ğŸ’° æœ€çµ‚é‡‘éŒ¢: ${this.state.money}G
            `;
        }
    };
</script>

</body>
</html>